<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>جدول النقاط - لوحة التحكم</title>
  <link rel="shortcut icon" href="/imgs/Christian favicon.jpeg" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Playpen+Sans+Arabic:wght@100..800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="style.css">
</head>
<body style="font-family:Playpen Sans Arabic,cursive;">

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg mt-3 p-0" style="background-color:#FEB21A;">
    <div class="container">
      <a class="navbar-brand fs-3" href="index.html">
        <i class="fa-solid fa-church"></i>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="navbarNavDropdown">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link text-light active" href="index.html">الصفحة الرئيسية</a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-light" href="index.html#alMosab2">مسابقة الأسرة</a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-light" href="index.html#about">عن الأسرة</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main -->
  <main class="container my-5" style="color:#0d335e;">
    <h2 class="text-center mb-4">لوحة التحكم - تعديل نقاط الأولاد</h2>
    <table id="boysTable" class="table table-striped table-bordered shadow">
      <thead class="table-warning">
        <tr>
          <th>الترتيب</th>
          <th>الاسم</th>
          <th class="text-center">النقاط</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
        <!-- Footer -->
        <footer class="text-center py-3 mt-5" style="background-color:#FEB21A; color:#fff;">
          <p class="mb-0 fs-6">
            &copy; 2025 أسرة أبونا يسطس الأنطوني والقديس يوسف الصديق - كنيسة الشهيد العظيم مارجرجس
            <br> by | eng | Benjamin
          </p>
        </footer>
  </main>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
    import { getFirestore, collection, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";

    // ----------------- منع الدخول بدون تسجيل
    if (!localStorage.getItem("loggedIn")) {
      window.location.href = "login.html";
    }

    // ----------------- إعداد Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCNj0P9AgNazzEN86oLrMo0hzMg6E34R6U",
      authDomain: "benjaminasham-9c7d2.firebaseapp.com",
      projectId: "benjaminasham-9c7d2",
      storageBucket: "benjaminasham-9c7d2.appspot.com",
      messagingSenderId: "182864629177",
      appId: "1:182864629177:web:65e67ae295ecdb6b84ba68",
      measurementId: "G-8RHE4H5JYV"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ----------------- أسماء الأولاد
    const boys = [
      "باسوتير سامح","روبن رامي","روجيه نشات","روجيه جورج","كيرلس رمسيس","ايفان هاني",
      "هاني ايمن","مارك ايهاب","مارتن ماركو","ماثيو مينا","ماثيو حنا","مينا شنودة",
      "مينا عماد","كاراس بسام","فيلوبتير مينا","يسى نسيم","بيشوي دميان","ادم ناجي"
    ];
    boys.sort((a, b) => a.localeCompare(b, 'ar'));

    const tableBody = document.querySelector("#boysTable tbody");

    // ----------------- تحميل وتحديث النقاط Live
    function loadScoresRealtime() {
      onSnapshot(collection(db, "quiz_scores"), (snapshot) => {
        const scoresMap = {};
        snapshot.forEach(d => {
          const data = d.data();
          scoresMap[data.name] = data.score;
        });

        tableBody.innerHTML = "";
        boys.forEach((name, index) => {
          const score = scoresMap[name] || 0;
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${index + 1}</td>
            <td>${name}</td>
            <td class="text-center">
              <button class="btn btn-sm btn-success me-2 plus">+</button>
              <span class="score fw-bold">${score}</span>
              <button class="btn btn-sm btn-danger ms-2 minus">-</button>
            </td>
          `;
          tableBody.appendChild(tr);

          // زر + 
          tr.querySelector(".plus").addEventListener("click", async () => {
            const scoreEl = tr.querySelector(".score");
            let newScore = parseInt(scoreEl.textContent) + 1;
            scoreEl.textContent = newScore;
            await setDoc(doc(db, "quiz_scores", name), { name, score: newScore }, { merge: true });
          });

          // زر - 
          tr.querySelector(".minus").addEventListener("click", async () => {
            const scoreEl = tr.querySelector(".score");
            let newScore = parseInt(scoreEl.textContent) - 1;
            if (newScore < 0) newScore = 0;
            scoreEl.textContent = newScore;
            await setDoc(doc(db, "quiz_scores", name), { name, score: newScore }, { merge: true });
          });
        });
      });
    }

    document.addEventListener("DOMContentLoaded", loadScoresRealtime);
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

